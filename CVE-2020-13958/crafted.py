import zipfile
import os
from lxml import etree

def create_odt_file(output_directory, odt_file_name, xml_content, 
                    manifest_content):
    # Ensure output directory exists
    os.makedirs(output_directory, exist_ok=True)

    odt_file_path = os.path.join(output_directory, odt_file_name)

    try:
        # Parse XML content to ensure it's well-formed
        etree.fromstring(xml_content.encode('utf-8'))

        # Create the ODT file
        with zipfile.ZipFile(odt_file_path, 'w') as odt_file:
            # Write the mimetype file (must be the first entry and uncompressed)
            odt_file.writestr('mimetype', 'application/vnd.oasis.opendocument.text', 
                              compress_type=zipfile.ZIP_STORED)
            
            # Write the content.xml with provided XML content
            odt_file.writestr('content.xml', xml_content, 
                              compress_type=zipfile.ZIP_DEFLATED)
            
            # Write the META-INF/manifest.xml
            odt_file.writestr('META-INF/manifest.xml', manifest_content,
                               compress_type=zipfile.ZIP_DEFLATED)

        print(f"ODT file successfully created at {odt_file_path}")
        return True

    except etree.XMLSyntaxError as e:
        print(f"XML Syntax Error: {e}")
    except Exception as e:
        print(f"An unexpected error occurred: {e}")

    return False

# Path where the ODT file will be saved
output_directory = r'G:\Work\Docs\Chester\Sem1\SE\Assignment 1\Work\Apache\Exploits'
odt_file_name = 'totallynothacking.odt'

# XML content for content.xml
xml_content = '''
<office:document-content xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:textooo="http://openoffice.org/2013/office" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" office:version="1.2">
    
    <office:scripts>
   <office:event-listeners>
    <script:event-listener script:language="ooo:script"
        xlink:href=".uno:OpenHyperlinkOnCursor" script:event-name="dom:load"/>
   </office:event-listeners>

</office:scripts>

<office:body>
    <office:text>

    <text:p text:style-name="Standard">
        <text:a xlink:type="simple" xlink:href="https://geekprank.com/fake-virus/" xmlns:xlink="http://www.w3.org/1999/xlink">
            <text:span text:style-name="Simple" style:text-underline-style="none" fo:color="#FFFFFF" fo:font-size="20pt">Open GeekPrank</text:span>
        </text:a>
    </text:p>



        <!-- Sender's Information -->
        <text:p text:style-name="SenderInfo">Senior Software Engineer</text:p>
        <text:p text:style-name="SenderInfo">Grey Tech Solutions</text:p>
        <text:p text:style-name="SenderInfo">123 Tech Street, Suite 200</text:p>
        <text:p text:style-name="SenderInfo">City, State, Zip Code</text:p>
        <text:p text:style-name="SenderInfo">Phone Number: 555-123-4567</text:p>
        <text:p text:style-name="SenderInfo">Email Address: john.smith@abctechsolutions.com</text:p>
        <text:p text:style-name="SenderInfo">February 29, 2024</text:p>
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        
        <!-- Recipient's Information -->
        <text:p text:style-name="RecipientInfo">Emily Johnson</text:p>
        <text:p text:style-name="RecipientInfo">HR Manager</text:p>
        <text:p text:style-name="RecipientInfo">Greys Enterprises</text:p>
        <text:p text:style-name="RecipientInfo">456 Business Avenue</text:p>
        <text:p text:style-name="RecipientInfo">Chester, CH02 6b, Dolphin Street 7B</text:p>
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <!-- Letter Body -->
        <text:p text:style-name="LetterBody">Dear Emily Johnson,</text:p>
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        
        <text:p text:style-name="LetterBody">I hope this message finds you well. I am writing to bring to your attention a concern regarding a software application that is integral to our daily operations. As a dedicated member of the Software Development Team at ABC Tech Solutions, I believe it is crucial to address this matter promptly to ensure smooth workflow and efficiency within our organization.</text:p>
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <text:p text:style-name="LetterBody">The software in question, TechPro Suite, has been experiencing certain issues that are hindering our productivity. These issues include frequent crashes when handling large datasets and occasional data corruption errors. Despite our efforts to troubleshoot and resolve these issues internally, it has become apparent that an updated version of the software is necessary to address these concerns effectively.</text:p>
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <text:p text:style-name="LetterBody">I kindly request that the HR department facilitates the download and installation of the latest version of TechPro Suite for all relevant personnel. This updated version, as per the release notes, promises to rectify the aforementioned issues and enhance the overall performance and usability of the software.</text:p>
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <text:p text:style-name="LetterBody">Furthermore, I would appreciate it if the HR department could disseminate any necessary instructions or guidelines for the installation process to ensure a smooth transition to the new version. Additionally, if there are any licensing or procurement procedures required for obtaining the updated software, please let me know so that I can assist in expediting the process.</text:p>
        
        <text:p text:style-name="LetterBody">Ensuring that our team has access to reliable and efficient tools is paramount to our success, and I believe that addressing this software issue promptly will contribute to our collective productivity and satisfaction.</text:p>
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <text:p text:style-name="LetterBody">Thank you for your attention to this matter. I am available to provide any further information or assistance as needed. Your support in resolving this issue is greatly appreciated.</text:p>
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <!-- Empty paragraph for extra space -->
        <text:p text:style-name="Standard" />
        <text:p text:style-name="LetterBody">Warm regards,</text:p>
        
        <text:p text:style-name="LetterBody">John Smith</text:p>
        
        <text:p text:style-name="LetterBody">Senior Software Engineer</text:p>
    </office:text>
</office:body>



</office:document-content>
'''

# Manifest content for META-INF/manifest.xml
manifest_content = '''<?xml version="1.0" encoding="UTF-8"?>
<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0">
    <manifest:file-entry manifest:media-type="application/vnd.oasis.opendocument.text" manifest:full-path="/"/>
    <manifest:file-entry manifest:media-type="text/xml" manifest:full-path="content.xml"/>
</manifest:manifest>'''

# Create the ODT file
create_odt_file(output_directory, odt_file_name, xml_content, manifest_content)
